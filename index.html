<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Family Tree Viewer</title>
  <style>
    body { font-family: Arial, sans-serif; white-space: pre; background: #111; color: #eee; padding: 20px; }
    .person { margin-left: 20px; }
    .root { font-weight: bold; }
  </style>
</head>
<body>
  <h1>Family Tree</h1>
  <div id="tree"></div>

  <script>
    async function loadGEDCOM() {
      const response = await fetch('family_tree.ged');
      const text = await response.text();
      return text;
    }

    function parseGEDCOM(gedText) {
      const people = {};
      const families = {};
      let currentId = null;
      let currentFam = null;
      const lines = gedText.split(/\r?\n/);

      for (const line of lines) {
        const parts = line.split(' ');
        if (parts.length < 2) continue;
        const level = parts[0];

        if (parts[1].startsWith('@I') && parts[2] === 'INDI') {
          currentId = parts[1];
          people[currentId] = { name: '', famc: null, fams: [] };
        } else if (parts[1].startsWith('@F') && parts[2] === 'FAM') {
          currentFam = parts[1];
          families[currentFam] = { husb: null, wife: null, chil: [] };
        } else if (parts[1] === 'NAME' && currentId) {
          people[currentId].name = parts.slice(2).join(' ').replace(/\//g, '');
        } else if (parts[1] === 'FAMC' && currentId) {
          people[currentId].famc = parts[2];
        } else if (parts[1] === 'FAMS' && currentId) {
          people[currentId].fams.push(parts[2]);
        } else if (parts[1] === 'HUSB' && currentFam) {
          families[currentFam].husb = parts[2];
        } else if (parts[1] === 'WIFE' && currentFam) {
          families[currentFam].wife = parts[2];
        } else if (parts[1] === 'CHIL' && currentFam) {
          families[currentFam].chil.push(parts[2]);
        }
      }

      return { people, families };
    }

    function findRoots(people) {
      return Object.entries(people)
        .filter(([id, person]) => !person.famc)
        .map(([id, person]) => id);
    }

    function buildTree(id, people, families, depth = 0) {
      const person = people[id];
      if (!person) return '';
      let tree = ' '.repeat(depth * 4) + person.name + '\n';

      for (const famId of person.fams) {
        const fam = families[famId];
        if (!fam) continue;

        if (fam.husb && fam.wife) {
          tree += ' '.repeat(depth * 4) + fam.husb && fam.wife ? `${people[fam.husb]?.name || ''} + ${people[fam.wife]?.name || ''}\n` : '';
          tree += ' '.repeat(depth * 4) + '    |\n';
        }

        for (const childId of fam.chil) {
          tree += buildTree(childId, people, families, depth + 1);
        }
      }

      return tree;
    }

    async function main() {
      const gedText = await loadGEDCOM();
      const { people, families } = parseGEDCOM(gedText);
      const roots = findRoots(people);

      let treeText = '';
      for (const rootId of roots) {
        treeText += buildTree(rootId, people, families) + '\n';
      }

      document.getElementById('tree').textContent = treeText.trim();
    }

    main();
  </script>
</body>
</html>
